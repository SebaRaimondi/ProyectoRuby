<div class="container">
    <div class="row">
        <h1 style="text-align: center;"><%= (@course.title.to_s + " - " + @course.year.to_s).html_safe %></h1>
    </div>
    <br>
    <div class="row">
        <table class="table table-hover table-bordered">
            <thead>
                <tr>
                    <th rowspan="2" style="vertical-align: middle;">Alumnos</th>
                    <th colspan="<%= @course.exams.size %>">Examenes</th>
                </tr>
                <tr>
                    <% if @course.exams.empty? %>
                        <td>No se cargo ningnun examen todavia</td>
                    <% else %>
                        <% @course.exams.each do |e| %>
                            <th><%= e.title %></th>
                        <% end %>
                    <% end %>
                </tr>
            </thead>
            <tbody>
                <% @course.students.each do |s| %>
                    <tr>
                        <td><%= "#{s.surname}, #{s.name}" %></td>
                        <% if @course.exams.empty? %>
                            <td></td>
                        <% else %>
                            <% @course.exams.each do |e|
                                @mark = e.students.include?(s) ? s.mark_for(e) : "Ausente"
                                @class = if (@mark == 'Ausente' || @mark == nil)
                                    @mark = 'Ausente'
                                   'warning'
                                 elsif @mark < e.min
                                   'danger'
                                 else
                                   'success'
                                 end %>
                                <td class="<%= @class %>"><%= @mark %></td>
                            <% end %>
                        <% end %>
                    </tr>
                <% end %>
                <% if !@course.exams.empty? %>
                    <tr>
                        <td>Aprobados</td>
                        <% @course.exams.each do |e| %>
                            <td><%= Result.passed(e.id, e.min).count %></td>
                        <% end %>
                    </tr>
                    <tr>
                        <td>Desaprobados</td>
                        <% @course.exams.each do |e| %>
                            <td><%= Result.failed(e.id, e.min).count %></td>
                        <% end %>
                    </tr>
                    <tr>
                        <td>Ausentes</td>
                        <% @course.exams.each do |e| %>
                            <td><%= @course.students.count - (Result.passed(e.id, e.min).count + Result.failed(e.id, e.min).count) %></td>
                        <% end %>
                    </tr>
                    <tr>
                        <td>Porcentaje de aprobacion</td>
                        <% @course.exams.each do |e| %>
                            <td><%= ((Result.passed(e.id, e.min).count.to_f / (Result.passed(e.id, e.min).count + Result.failed(e.id, e.min).count)) * 100)%>%</td>
                        <% end %>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </div>
    <div class="row" style="text-align: center">
        <div class="center-helper container">
            <%= link_to '<button type="button" class="button btn-red" style="font-size: 11px">Volver a Cursadas</button>'.html_safe, courses_path %>
            <button type="button" class="button" data-toggle="modal" data-target="#resultsModal" style="font-size: 11px">Modificar Notas</button>
            <%= link_to '<button type="button" class="button" style="font-size: 11px">Administrar Examenes</button>'.html_safe, course_exams_path(@course) %>
            <%= link_to '<button type="button" class="button" style="font-size: 11px">Administrar Alumnos</button>'.html_safe, course_students_path(@course) %>
        </div>
    </div>
</div>
<div class="modal fade" id="resultsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title">Modificar Notas</h4>
            </div>
            <%= form_tag(course_results_path(@course), method: "post") do %>
            <div class="modal-body">
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr>
                            <th rowspan="2" style="vertical-align: middle;">Alumnos</th>
                            <th colspan="<%= @course.exams.size %>">Examenes</th>
                        </tr>
                        <tr>
                            <% @course.exams.each do |e| %>
                                <th><%= e.title %></td>
                            <% end %>
                        </tr>
                    </thead>
                    <tbody>
                        <% @course.students.each do |s| %>
                            <tr>
                                <td><%= "#{s.surname}, #{s.name}" %></td>
                                <% @course.exams.each do |e| %>
                                    <%
                                            @mark = e.students.include?(s) ? s.mark_for(e) : ''
                                            @class = if (@mark == '' || @mark == nil)
                                                @mark = ''
                                                'warning'
                                            elsif @mark < e.min
                                                'danger'
                                            else
                                                'success'
                                            end
                                            @name = "results[#{e.id}[#{s.id}]]"
                                        %>
                                        <td class="<%= @class %>">
                                            <input class="input-nota" type="number" min="0" name="<%= @name %>" value="<%= @mark %>">
                                        </td>
                                    <% end %>
                                </tr>
                            <% end %>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <input type="submit" class="btn btn-primary" value="Guardar Cambios"></button>
            </div>
        <% end %>
    </div>
    <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->